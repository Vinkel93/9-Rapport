\chapter{System Description}
\label{system_description}

\section{Components of the System}
\label{systemcomponents}
%
\input{report/appendix/system_table.tex}
\input{report/appendix/fitting_table.tex}
\input{report/appendix/valve_table.tex}
\input{report/appendix/pump_table.tex}

\pagebreak


\section{System Topology}

% \begin{figure}[H]
%   \centering
%   % \begin{minipage}[b]{0.45\textwidth}
%   %   \centering
%   %  % \tikzsetnextfilename{basic_example_sys}
%   %   \input{report/tikz/basic_example_sys} 
%   %   \caption{Basic water distribution network.}
%   %   \label{fig:Basic_example_sys}
%   % \end{minipage}
%   % \hspace{15pt}
%   \begin{minipage}[b]{0.45\textwidth}
%     \begin{tabular}{|c|c|} \hline
%       \bfseries Symbol                                                         & \bfseries Name                \\ \hline
%       %\tikzsetnextfilename{pump}\input{report/tikz/pump}                       & Pump                          \\ \hline
%       %\tikzsetnextfilename{manual_valve}\input{report/tikz/manual_valve}       & Manual valve                  \\ \hline
%       \begin{figure}\tikzsetnextfilename{elec_valve}\input{report/tikz/elec_valve.tex}\end{figure}           & Electronic valve              \\ \hline
%       %\tikzsetnextfilename{pipe}\input{report/tikz/pipe}                       & Pipe segment                  \\ \hline
%       %\tikzsetnextfilename{pressure_sensor}\input{report/tikz/pressure_sensor} & Pressure sensor              \\ \hline
%       %\tikzsetnextfilename{dif_pres_sens}\input{report/tikz/dif_pres_sens}     & Differential pressure sensor  \\ \hline
%       %\tikzsetnextfilename{gnd}\input{report/tikz/gnd}                         & Gnd                           \\ \hline
%     \end{tabular}
%     \captionof{table}{Symbol and name for component in the water network.}  
%     \label{tab:sys_comp_overview}
%   \end{minipage}
% \end{figure}


\label{systemdiagram}
%tikz of system diagram
\begin{figure}[H]
\centering
\resizebox{0.75\linewidth}{!}{\input{report/tikz/full_sys_diagram.tex}}
%\input{report/tikz/full_sys_diagram.tex} 
%\caption{system diagram}
\label{systemdiagram}
\end{figure}

\begin{figure}[H]
  \begin{minipage}[b]{0.45\textwidth}
    \begin{tabular}{|c|c|} \hline
      \bfseries Symbol                      & \bfseries Name                \\ \hline
      \input{report/tikz/pump}              & Pump                          \\ \hline
      \input{report/tikz/manual_valve}      & Manual valve                  \\ \hline
      \input{report/tikz/elec_valve}        & Electronic valve              \\ \hline
      \input{report/tikz/pipe}              & Pipe segment                  \\ \hline
      \input{report/tikz/pressure_sensor}   & Pressure sensor              \\ \hline
      \input{report/tikz/dif_pres_sens}     & Differential pressure sensor  \\ \hline
      \input{report/tikz/gnd}               & Gnd                           \\ \hline
    \end{tabular}
    \captionof{table}{Symbol and name for component in the water network.}  
    \label{tab:sys_comp_overview}
  \end{minipage}
\end{figure}



\section{System Graph}
\label{systemgraph}
\begin{figure}[H]
\centering
%\input{report/tikz/SystemGraph.tex} 
\resizebox{1\linewidth}{!}{\input{report/tikz/SystemGraph.tex}}
\end{figure}

\section{Spanning Tree}
\label{spanningtree}
\begin{figure}[H]
\centering
%\input{report/tikz/SpanningTree.tex} 
\resizebox{0.9\linewidth}{!}{\input{report/tikz/SpanningTree.tex}}
\end{figure}

\section{Incidence Matrix}
\label{IncidenceSection}
%\todo{Vinkel! this matrix appears in a different page than the section title, Also with the cycle matrix}
%\begin{sidewaysfigure}
\vspace{4mm}
\begin{equation}
  \label{graph_nodes}
%\resizebox{0.6\hsize}{!}{
%\rotatebox{90}{$
\begin{adjustbox}{max width=\textwidth}$H
=
\left[
\begin{array}{*{26}c}
   $ 18x24$ & e2 & e3 & e4 & e5 & e6 & e11 & e21 & e23 & e1 & e7 & e8 & e9 & e10 & e12 & e13 & e14 & e15 & e16 & e17 & e18 & e19 & e20 & e22 & e24 & 
e25 \\
n1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 1 & 0 & 0 & 0 & -1 & 0 & -1 & 0 & 0 & 0 & 0 & -1 & -1 & 0 & -1 
\\
n2 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
\\
n3 & -1 & 1 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 
\\
n4 & 0 & -1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
\\
n5 & 0 & 0 & -1 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
\\
n6 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 
0 \\
n7 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
\\
n8 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
\\
n9 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 1 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
\\
n10 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 
0\\
n11 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
\\
n12 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
\\
n13  &  0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 
\\
n14 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 1 & 0 & 0 & 0 & 0 & 0 
\\
n15 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 
\\
n16 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 1 & 0 & 0 & 0 & 0 
\\
n17 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 1 & 0 & 0 & 0 
\\
n18 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -1 & 1 


\end{array}
\right]$% }}
\end{adjustbox}
\end{equation}

\section{Cycle Matrix}
\label{CycleAppendix}
\vspace{4mm}

\begin{equation}
  \label{ComponentState}
%\resizebox{0.28\hsize}{!}{
%\rotatebox{90}{$
\begin{adjustbox}{max width=\textwidth}$B
=
\left[
\begin{array}{*{25}c}

1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1
 \\
  0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0   & -1   & -1
 \\
  0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0   & -1  &  -1 & 0 & 0   & -1  &  -1 & 1 & 1 & 1 & 1 & 1 & 0 & 0 & 0
 \\
  0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 1 & 1 & 1 & 0 & 0 & 0
 \\
  0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1
 \\
  0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1  &  -1  &  -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
 \\
  0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0  &  -1  &  -1   & -1 & 1 & 0 & 0
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0   & -1    &-1 & 0 & 0 & 1 & 1 & 1 & 0 & 0 & 0
  
\end{array}
\right]$ %} }
\end{adjustbox}
\end{equation}
\vspace{-10mm}

\section{Mapping matrices}
\label{MappingAppendix}

\vspace{5mm}


\[
G=\left[\begin{array}{*{2}c}
0 & 0 \\
0 & 0 \\ 
0 & 0 \\ 
0 & 0 \\
0 & 0 \\
0 & 0 \\ 
0 & 0 \\ 
0 & 0 \\
1 & 0 \\
0 & 0 \\ 
0 & 1 \\ 
0 & 0 \\
0 & 0 \\
0 & 0 \\ 
0 & 0 \\ 
0 & 0 \\
0 & 0 \\
0 & 0 \\ 
0 & 0 \\ 
0 & 0 \\
0 & 0 \\
0 & 0 \\ 
0 & 0 \\ 
0 & 0 
  \end{array}\right]
\qquad
G_p=\left[\begin{array}{*{8}c}
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
 \\
 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
  \end{array}\right]
\]


%\pagebreak
%
%\section{Pipe Jacobian matrix}
%\label{PipeJacobianAppendix}
%\begin{equation}
%\frac{\partial{\lambda(\pmb{{B_1^{T}}}\pmb{z})}}{{\partial{\pmb{{B_1^{T}}}\pmb{z}}}}_{|\pmb{\bar{z}}}
%=
%\left[
%\begin{array}{*{8}c}
%\frac{\partial{\lambda(\pmb{{B_{1;1}^{T}}}\pmb{z})}}{{\partial{\pmb{{B_1^{T}}}\pmb{z}}}}_{|\bar{z}} & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
%0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
%0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 
% \\
% 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 
%
%\end{array}
%\right]
%\pmb{{B_1^{T}}}
%\end{equation}





